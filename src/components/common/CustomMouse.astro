---
import { Picture } from '@astrojs/image/components';
import stickman from '~/assets/images/THE-CAKE-IS-A-LIE/portal-stickman.png';
---

<div id="esfera-container">
  <div id="esfera">
    <svg
      id="welcome"
      fill="#fff"
      width="70px"
      height="70px"
      viewBox="0 0 256.00 256.00"
      transform="matrix(1, 0, 0, 1, 0, 0)"
      ><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g
        id="SVGRepo_tracerCarrier"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke="#CCCCCC"
        stroke-width="2.048"></g><g id="SVGRepo_iconCarrier">
        <path
          d="M168,30.99268A8.00009,8.00009,0,0,1,176,23h.00781A60.21143,60.21143,0,0,1,227.9541,53.00439a8.00044,8.00044,0,1,1-13.85742,8A44.16357,44.16357,0,0,0,175.99219,39,8,8,0,0,1,168,30.99268Zm60.99512,139.772A88.01088,88.01088,0,0,1,67.7832,191.98828l-42-72.74609A27.991,27.991,0,0,1,47.77832,77.33807L44.4248,71.5293A28.00473,28.00473,0,0,1,87.44922,36.74976a27.99212,27.99212,0,0,1,48.11328.63549l17.34326,30.04a28.01379,28.01379,0,0,1,47.29834,1.92243l19.999,34.64062A87.41865,87.41865,0,0,1,228.99512,170.76465Zm-22.64746-58.77637-20-34.64062A12.00012,12.00012,0,1,0,165.5625,89.34717l10,17.3208a7.98085,7.98085,0,0,1,.36475.7121c.08007.17706.1455.35723.21191.53735.02393.0647.05322.12756.0752.19281.0747.22082.13574.44385.19043.66772.00634.02771.01611.05469.02294.08252.05323.23029.09327.4618.126.69373.00342.02508.00977.04974.01318.07489.02881.22156.04444.44342.05469.66522.00147.03882.00733.07733.00879.11621.00635.20417-.00049.40753-.00976.61078-.00245.05823,0,.11633-.00391.17456-.0127.19092-.03858.38007-.06494.56922-.00977.06988-.01319.14013-.0249.2099-.0376.227-.08838.45141-.145.67419-.00782.02972-.01172.05994-.01954.0896-.0083.0304-.0205.05914-.0288.08942-.062.22088-.13038.44-.21094.655-.02246.05945-.05127.11567-.07471.17444-.07422.18415-.1499.36774-.2373.54621-.02149.0429-.04688.083-.06885.12548-.09815.19062-.19971.37934-.31348.5622-.01318.02112-.02832.04053-.0415.06152-.12647.19947-.25977.3949-.4043.5835l-.01758.02087q-.22925.29737-.48779.575l-.01611.01586c-.17188.18268-.352.35907-.543.52668-.03125.0274-.06592.051-.09766.07788-.166.1416-.33545.28088-.51562.41009a7.96868,7.96868,0,0,1-.66992.43329,32.00043,32.00043,0,0,0-11.71387,43.71289,7.99959,7.99959,0,1,1-13.85547,8,48.025,48.025,0,0,1,10.9707-60.998L151.707,97.34766l-.00244-.0044L121.707,45.38574a12.00023,12.00023,0,1,0-20.78515,12l25.999,45.03369a8,8,0,0,1-13.85645,8l-26-45.03369-.01562-.02826L79.06543,51.5293A12.00012,12.00012,0,0,0,58.28027,63.52881l15.99707,27.7077.00293.00519,22,38.106A7.95946,7.95946,0,0,1,92.47852,140.706c-.08643.03675-.17334.06806-.26026.10157q-.33105.12771-.66748.22454c-.08935.02564-.17773.05225-.26758.07465a7.93311,7.93311,0,0,1-.84131.16473c-.0249.00342-.0498.00989-.0747.01307a7.94421,7.94421,0,0,1-.93018.05963c-.02539.00024-.05127.00494-.07666.00494-.05273,0-.10449-.00915-.15723-.01019q-.364-.00723-.72412-.04675c-.08593-.00953-.17138-.01832-.25683-.03058a8.05171,8.05171,0,0,1-.85449-.16712c-.01954-.00506-.03956-.00769-.05909-.01288a8.05256,8.05256,0,0,1-.88867-.29571c-.07471-.0293-.14648-.06305-.22021-.09454q-.33106-.14174-.64844-.313c-.07617-.041-.15186-.08075-.22705-.12421a8.0088,8.0088,0,0,1-.76807-.50262l-.01758-.012a8.00346,8.00346,0,0,1-.72412-.62359c-.06006-.05823-.11767-.12-.17627-.1803q-.25928-.26541-.4956-.5578c-.05469-.06781-.11035-.134-.16309-.204a8.01625,8.01625,0,0,1-.55566-.82623l-22-38.10547a11.99994,11.99994,0,0,0-20.78418,12.00049l42,72.7456a72.00015,72.00015,0,0,0,124.708-72ZM85.65234,233.42871a103.08083,103.08083,0,0,1-30.72461-33.438,7.99959,7.99959,0,1,0-13.85546,8,118.949,118.949,0,0,0,35.46289,38.58643,8.00007,8.00007,0,1,0,9.11718-13.14844Z"
        ></path>
      </g></svg
    >
    <svg width="0" height="0">
      <defs>
        <filter id="motionBlur">
          <feGaussianBlur in="SourceGraphic" stdDeviation="0 0"></feGaussianBlur>
        </filter>
      </defs>
    </svg>
    <Picture
      id="stickman"
      class="absolute hidden w-3/4 top-0 left-1/3"
      alt="glad-os"
      widths={[400, 768, 1024, 2040]}
      sizes="(max-width: 767px) 400px, (max-width: 1023px) 768px, (max-width: 2039px) 1024px, 2040px"
      loading="eager"
      width={1024}
      height={1024}
      src={stickman}
    />
  </div>
</div>
<script>
  import { gsap } from 'gsap';
  document.addEventListener('DOMContentLoaded', () => {
    const portal = document.getElementById('portal');
    const esfera = document.getElementById('esfera');

    if (!esfera) {
      console.error('No se pudo encontrar la esfera en el DOM.');
      return;
    }
    let x = window.innerWidth / 2;
    let y = window.innerHeight / 2;
    let mouseX = x;
    let mouseY = y;
    let esferaScale = 0.5;

    gsap.to(esfera, {
      duration: 0.15,
      delay: 0.1,
      opacity: 1,
    });

    gsap.to(esfera, {
      scale: esferaScale,
      duration: 0.75,
      delay: 0.75,
      opacity: 1,
      border: '2px solid #fff',
      background: 'transparent',
      ease: 'Expo.easeOut',
    });

    function lerp(start, end, amount) {
      return (1 - amount) * start + amount * end;
    }

    function animate() {
      x = lerp(x, mouseX, 0.1);
      y = lerp(y, mouseY, 0.1);
      if (esfera) {
        gsap.set(esfera, {
          x: x - esfera.clientWidth / 2,
          y: y - esfera.clientHeight / 2,
        });
      }

      requestAnimationFrame(animate);
    }

    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
    });
    document.addEventListener('mousedown', () => {
      gsap.to(esfera, {
        scale: esferaScale * 0.85,
        ease: 'Expo.easeOut',
      });
    });
    document.addEventListener('mouseup', () => {
      gsap.to(esfera, {
        scale: esferaScale,
        ease: 'Expo.easeOut',
      });
    });

    // MAGNETIC
    const magnetic = () => {
      const magnetics = document.querySelectorAll('.magnetic');
      if (magnetics.length === 0) return;

      magnetics.forEach((magnetic) => {
        const magneticElement = magnetic as HTMLElement; // AserciÃ³n de tipo a HTMLElement
        const xTo = gsap.quickTo(magneticElement, 'x', { duration: 1, ease: 'elastic.out(1, 0.5)' });
        const yTo = gsap.quickTo(magneticElement, 'y', { duration: 1, ease: 'elastic.out(1, 0.5)' });
        const strength = magneticElement.dataset.strength ? parseFloat(magneticElement.dataset.strength) : 1.15;
        magneticElement.addEventListener('mouseenter', () => {
          gsap.to(esfera, {
            scale: 0.75,
            duration: 0.5,
            ease: 'Expo.easeOut',
          });
        });

        magneticElement.addEventListener('mousemove', (e) => {
          const { clientX, clientY } = e;
          const { height, width, left, top } = magneticElement.getBoundingClientRect();
          const x = clientX - (left + width / 2);
          const y = clientY - (top + height / 2);
          esferaScale = 0.75;

          gsap.to(esfera, {
            scale: esferaScale,
          });

          xTo(x * strength);
          yTo(y * strength);
        });

        magneticElement.addEventListener('mouseleave', () => {
          xTo(0);
          yTo(0);
          esferaScale = 0.5;
          gsap.to(esfera, {
            scale: esferaScale,
            duration: 0.5,
            ease: 'Expo.easeOut',
          });
        });
      });
    };
    magnetic();

    // THE 404 PAGE IS A LIE
    if (portal) {
      const stickman = document.getElementById('stickman');
      portal.addEventListener('mouseenter', () => {
        gsap.fromTo(
          esfera,
          {
            scale: 0.5,
            rotate: '36deg',
          },
          {
            border: '4px solid #ff9142',
            boxShadow: '0px 0px 75px 0px #de5f03, inset 0px 0px 35px 1px #ff6e00',
            skewY: '30deg',
            scale: 0.9,
            duration: 0.3,
            ease: 'Expo.easeOut',
          }
        );
        gsap.set(stickman, {
          display: 'flex',
        });
      });
      portal.addEventListener('mouseout', () => {
        gsap.to(esfera, {
          skewY: '0deg',
          scale: 0.5,
          duration: 0.3,
          border: '2px solid #fff',
          boxShadow: 'unset',
          background: 'transparent',
          ease: 'Expo.easeOut',
        });
        gsap.set(stickman, {
          display: 'none',
        });
      });
    }
    animate();
  });
</script>
